# ejapp

## Overview
**ejapp** is a full-stack web application starter that showcases a token-based authentication flow with a simple "items" feature. The monorepo combines a FastAPI backend and a Vite + TypeScript frontend, wired together with JWT authentication (including a simulated Google OAuth callback) and end-to-end tests. It is intended as a foundation for experimenting with new features while keeping setup friction low.

### Current Features
- User registration and email/password login with hashed passwords.
- Refreshable JWT authentication and a mock Google OAuth sign-in.
- Protected item list with create/read operations tied to the authenticated user.
- Async SQLite database access via SQLAlchemy and Alembic migrations.
- Unit and end-to-end coverage using Pytest, Vitest, and Playwright.

## Tech Stack
| Area | Technologies |
| --- | --- |
| Backend | FastAPI, SQLAlchemy (async), Alembic, SQLite, Passlib, PyJWT |
| Frontend | Vite, TypeScript, Tailwind CSS |
| Tooling & Tests | Makefile automation, Pytest, Vitest, Playwright, Ruff, Prettier |

## Prerequisites
- Python 3.13+
- Node.js 20+ (includes npm)
- `make`
- Recommended: `sqlite3` CLI for inspecting the database, Google Chrome (or Chromium) for Playwright headed runs

## Installation & Setup
1. **Clone the repository**
   ```bash
   git clone <repo-url>
   cd ejapp
   ```
2. **Create a local environment file** at the repository root (loaded by the backend) and customise secrets as needed:
   ```bash
   cat > .env <<'ENV'
   SECRET_KEY="replace-me"
   ALGORITHM="HS256"
   ACCESS_TOKEN_EXPIRE_MINUTES=120
   REFRESH_TOKEN_EXPIRE_MINUTES=129600
   DATABASE_URL="sqlite+aiosqlite:///backend/ejapp.db"
   FRONTEND_ORIGIN="http://localhost:5173"
   ENV
   ```
3. **Install all dependencies** (Python virtual environment, backend packages, frontend packages, and pre-commit hooks):
   ```bash
   make setup
   ```
   - `make setup-backend` and `make setup-frontend` are available if you prefer to run them separately.

## Running the Application
- **Backend API** (FastAPI with Uvicorn):
  ```bash
  make run-backend
  ```
  Runs on [http://localhost:8000](http://localhost:8000) with auto-reload enabled and CORS configured for the dev frontend origin.
- **Frontend app** (Vite dev server):
  ```bash
  make run-frontend
  ```
  Serves the client at [http://localhost:5173](http://localhost:5173). The frontend reads `VITE_API_BASE` (defaults to `http://localhost:8000`) to call the backend.

> Use two terminals or panes—one for the backend and one for the frontend. `make run` prints a reminder of this workflow.

## Testing
- **Backend unit tests**:
  ```bash
  make test-backend
  ```
- **Frontend unit tests (Vitest)**:
  ```bash
  make test-frontend-unit
  ```
- **All automated checks** (backend + frontend unit):
  ```bash
  make test
  ```
- **End-to-end tests (Playwright)**:
  ```bash
  make test-e2e
  ```
  The E2E flow builds the frontend with `VITE_API_BASE=http://localhost:18100`, spins up a preview server on port 63343, and expects the backend to be running separately (often via `E2E=1 make run-backend` in another terminal for an isolated database).

## Database Migrations
- Create a new migration:
  ```bash
  make migrate-new m="Describe change"
  ```
- Apply migrations to the latest revision:
  ```bash
  make migrate-up
  ```
- Roll back the last migration:
  ```bash
  make migrate-down
  ```

Alembic configuration lives in `backend/alembic.ini`, and autogenerated migration files are stored under `backend/migrations/`.

## Repository Structure
```
.
├── backend/             # FastAPI app, async SQLAlchemy models, Alembic config, Pytest tests
│   ├── main.py          # Application factory, routes, auth, and DB session setup
│   ├── db.py            # SQLAlchemy models (User, Item) and declarative base
│   ├── migrations/      # Alembic migrations
│   └── tests/           # Pytest suite for API behaviour
├── frontend/            # Vite + TypeScript client with Tailwind styling
│   ├── src/             # Public landing page scripts, login/register UI
│   ├── private/         # Protected area consuming the authenticated API
│   └── tests/           # Playwright end-to-end scenarios and helpers
├── Makefile             # Automation for setup, testing, linting, formatting, and migrations
└── README.md            # Project overview (this file)
```

## Development Notes & Next Steps
- API documentation via Swagger UI is automatically available at `/docs` while the backend server is running.
- The project currently targets local development; production deployment will require hardening secrets, HTTPS, and a persistent database.
- Potential enhancements include additional domain models, real OAuth integration, and CI automation.

Happy hacking!
